import os, sys, time, random, json, socket
import cloudscraper
import requests
from time import sleep
from colorama import Fore, init
from rich.console import Console
from rich.prompt import IntPrompt
from rich.live import Live
from rich.text import Text
from rich.panel import Panel
from rich.table import Table
from rich.progress import Progress, SpinnerColumn, TextColumn, BarColumn, TimeElapsedColumn
from rich import box

init(autoreset=True)
console = Console()

def kiem_tra_mang():
    try:
        socket.create_connection(("8.8.8.8", 53), timeout=3)
    except OSError:
        console.print("[red]âŒ Máº¡ng khÃ´ng á»•n Ä‘á»‹nh hoáº·c máº¥t káº¿t ná»‘i![/red]")
        sys.exit(1)

kiem_tra_mang()
scraper = cloudscraper.create_scraper()

banner = f"""
{Fore.YELLOW}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
{Fore.YELLOW}â•‘                                                        â•‘
{Fore.YELLOW}â•‘   \033[38;2;0;120;255mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—     \033[0m{Fore.YELLOW}â•‘
{Fore.YELLOW}â•‘   \033[38;2;0;140;255mâ•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     \033[0m{Fore.YELLOW}â•‘
{Fore.YELLOW}â•‘   \033[38;2;0;160;255m   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     \033[0m{Fore.YELLOW}â•‘
{Fore.YELLOW}â•‘   \033[38;2;0;180;255m   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     \033[0m{Fore.YELLOW}â•‘
{Fore.YELLOW}â•‘   \033[38;2;0;200;255m   â–ˆâ–ˆâ•‘   â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—\033[0m{Fore.YELLOW}â•‘
{Fore.YELLOW}â•‘   \033[38;2;0;220;255m   â•šâ•â•    â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•\033[0m{Fore.YELLOW}â•‘
{Fore.YELLOW}â•‘                                                        â•‘
{Fore.YELLOW}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{Fore.WHITE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{Fore.WHITE}PhiÃªn Báº£n: {Fore.YELLOW}TOOL_GOLIKE_SNAPCHAT_â•‘ ADMIN: \033[38;2;0;220;255mVILÃ‚M
{Fore.WHITE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[{Fore.RED}âš¡{Fore.WHITE}] Zalo: \033[38;2;0;220;255m0368782618
[{Fore.RED}âš¡{Fore.WHITE}] LÆ°u Ã½: AE dÃ¹ng tool bá»‹ lá»—i thÃ¬ gá»i ADMIN Ä‘á»ƒ sá»­a
{Fore.WHITE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""

os.system('cls' if os.name == 'nt' else 'clear')
print(banner)
sleep(1)

# === Load Authorization & Token ===
def load_auth():
    try:
        with open("Authorization.txt", "r") as f:
            auth = f.read().strip()
        with open("token.txt", "r") as f:
            token = f.read().strip()
        if not auth or not token:
            raise FileNotFoundError
        return auth, token
    except:
        auth = input("ğŸ’¸ Nháº­p AUTHORIZATION GOLIKE: ")
        token = input("ğŸ’¸ Nháº­p TOKEN (T cá»§a GoLike): ")
        with open("Authorization.txt", "w") as f:
            f.write(auth)
        with open("token.txt", "w") as f:
            f.write(token)
        return auth, token

author, token = load_auth()

headers = {
    'Accept': 'application/json, text/plain, */*',
    'Content-Type': 'application/json;charset=utf-8',
    'Authorization': author,
    't': token,
    'User-Agent': 'Mozilla/5.0 (Linux; Android 10; K)',
    'Referer': 'https://app.golike.net/account/manager/snapchat',
}

def chonacc():
    try:
        res = scraper.get('https://gateway.golike.net/api/snapchat-account', headers=headers).json()
        return res
    except:
        sys.exit()

def nhannv(account_id):
    try:
        params = {'account_id': account_id, 'data': 'null'}
        res = scraper.get('https://gateway.golike.net/api/advertising/publishers/snapchat/jobs', headers=headers, params=params)
        return res.json()
    except:
        sys.exit()

def hoanthanh(ads_id, account_id):
    try:
        data = {'ads_id': ads_id, 'account_id': account_id, 'async': True, 'data': None}
        res = scraper.post('https://gateway.golike.net/api/advertising/publishers/snapchat/complete-jobs', headers=headers, json=data, timeout=6)
        return res.json()
    except:
        sys.exit()

def baoloi(ads_id, object_id, account_id, loai):
    try:
        scraper.post('https://gateway.golike.net/api/report/send', headers=headers, json={
            'description': 'TÃ´i Ä‘Ã£ lÃ m Job nÃ y rá»“i',
            'users_advertising_id': ads_id,
            'type': 'ads',
            'provider': 'snapchat',
            'fb_id': account_id,
            'error_type': 6,
        })
        scraper.post('https://gateway.golike.net/api/advertising/publishers/snapchat/skip-jobs', headers=headers, json={
            'ads_id': ads_id,
            'object_id': object_id,
            'account_id': account_id,
            'type': loai,
        })
    except:
        sys.exit()

# === Hiá»ƒn thá»‹ danh sÃ¡ch acc ===
response = chonacc()
if response.get("status") != 200:
    console.print("[red]âŒ Auth hoáº·c Token sai! Kiá»ƒm tra file.[/red]")
    sys.exit(1)

accounts = response["data"]
table = Table(title="ğŸ“± DANH SÃCH ACC", box=box.ROUNDED)
table.add_column("STT", style="cyan", justify="center")
table.add_column("TÃªn TÃ i Khoáº£n", style="magenta")
table.add_column("Tráº¡ng ThÃ¡i", style="green")

for i, acc in enumerate(accounts, 1):
    table.add_row(str(i), acc.get("name", "KhÃ´ng tÃªn"), "Online" if acc.get("status") == 1 else "Offline")

console.print(table)

# === Chá»n acc ===
while True:
    try:
        chon = int(input("ğŸ‘‰ Chá»n tÃ i khoáº£n: "))
        if 1 <= chon <= len(accounts):
            acc = accounts[chon - 1]
            account_id = acc["id"]
            break
    except:
        console.print("[red]âš ï¸ Nháº­p sai, thá»­ láº¡i![/red]")

# === Chá»n nhiá»‡m vá»¥ ===
nv_panel = Panel("[1] Nhiá»‡m vá»¥ Follow", title="ğŸ¯ Nhiá»‡m vá»¥", border_style="bright_blue")
console.print(nv_panel)

while True:
    try:
        loai_nv = IntPrompt.ask("ğŸ”° Chá»n loáº¡i nhiá»‡m vá»¥", default=1)
        if loai_nv == 1:
            break
    except:
        console.print("[red]âŒ Nháº­p sai![/red]")

# === Nháº­n job vÃ  lÃ m job ===
dem = tong = 0

def countdown(delay):
    spinner = ["|", "/", "-", "\\"]
    with Live(refresh_per_second=10) as live:
        for i in range(delay, -1, -1):
            spin = spinner[i % len(spinner)]
            panel = Panel(Text(f"â³ {spin} Delay chá»‘ng block | {i}s", style="bold green"), title="Äáº¿m ngÆ°á»£c")
            live.update(panel)
            sleep(1)

def nhan_tien_progress():
    with Progress(SpinnerColumn(), TextColumn("[progress.description]{task.description}"), BarColumn(), TimeElapsedColumn(), transient=True) as p:
        t = p.add_task("ğŸª™ Nháº­n xu", total=100)
        for _ in range(100):
            p.update(t, advance=1)
            time.sleep(0.01)

while True:
    job = nhannv(account_id)
    if job.get("status") != 200 or not job["data"].get("link"):
        console.print("[red]âŒ KhÃ´ng cÃ³ job. Äá»£i thÃªm...[/red]")
        time.sleep(2)
        continue

    ads_id = job["data"]["id"]
    object_id = job["data"]["object_id"]
    job_type = job["data"]["type"]

    if job_type != "follow":
        baoloi(ads_id, object_id, account_id, job_type)
        continue

    countdown(random.randint(10, 20))

    nhan = hoanthanh(ads_id, account_id)
    if nhan.get("status") == 200:
        nhan_tien_progress()
        xu = nhan["data"].get("prices", 0)
        tong += xu
        dem += 1
        tb = Table(title=f"ğŸ‰ JOB #{dem} HOÃ€N THÃ€NH", box=box.ROUNDED)
        tb.add_column("Thá»i gian", justify="center")
        tb.add_column("Xu nháº­n", justify="center")
        tb.add_column("Tá»•ng xu", justify="center")
        tb.add_row(time.strftime("%H:%M:%S"), f"+{xu} Ä‘", f"{tong:,} Ä‘")
        os.system('cls' if os.name == 'nt' else 'clear')
        print(banner)
        console.print(tb)
    else:
        baoloi(ads_id, object_id, account_id, job_type)
        console.print("[red]âŒ Job lá»—i, Ä‘Ã£ bÃ¡o lá»—i vÃ  bá» qua[/red]")
    sleep(1)
