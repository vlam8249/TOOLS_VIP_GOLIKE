import os
import sys
import time
import json
import socket
import requests
import cloudscraper
from colorama import Fore, init
from pystyle import Colorate, Colors
from rich.console import Console
from rich.table import Table

# Khá»Ÿi táº¡o
init(autoreset=True)
console = Console()
scraper = cloudscraper.create_scraper()

BOLD = "\033[1m"
AQUA = "\033[96m"
RESET = "\033[0m"

# Banner
banner = f"""
{Fore.YELLOW}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
{Fore.YELLOW}â•‘                                                        â•‘
{Fore.YELLOW}â•‘   \033[38;2;0;120;255mâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—     \033[0m{Fore.YELLOW}â•‘
{Fore.YELLOW}â•‘   \033[38;2;0;140;255mâ•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     \033[0m{Fore.YELLOW}â•‘
{Fore.YELLOW}â•‘   \033[38;2;0;160;255m   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     \033[0m{Fore.YELLOW}â•‘
{Fore.YELLOW}â•‘   \033[38;2;0;180;255m   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     \033[0m{Fore.YELLOW}â•‘
{Fore.YELLOW}â•‘   \033[38;2;0;200;255m   â–ˆâ–ˆâ•‘   â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—\033[0m{Fore.YELLOW}â•‘
{Fore.YELLOW}â•‘   \033[38;2;0;220;255m   â•šâ•â•    â•šâ•â•â•â•â•â•  â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•\033[0m{Fore.YELLOW}â•‘
{Fore.YELLOW}â•‘                                                        â•‘
{Fore.YELLOW}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{Fore.WHITE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
{Fore.RED}{Fore.WHITE}PhiÃªn Báº£n: {Fore.YELLOW}TOOL_GOLIKE_TIKTOK_â•‘ ADMIN: \033[38;2;0;220;255mVILÃ‚M
{Fore.WHITE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
[{Fore.RED}âš¡{Fore.WHITE}] Zalo: \033[38;2;0;220;255m0368782618
[{Fore.RED}âš¡{Fore.WHITE}] LÆ°u Ã½: \033[38;2;0;220;255mAE dÃ¹ng tool bá»‹ lá»—i thÃ¬ gá»i ADMIN Ä‘á»ƒ sá»­a
{Fore.WHITE}â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
"""

def kiem_tra_mang():
    try:
        socket.create_connection(("8.8.8.8", 53), timeout=3)
    except OSError:
        print("Máº¡ng khÃ´ng á»•n Ä‘á»‹nh hoáº·c bá»‹ máº¥t káº¿t ná»‘i. Vui lÃ²ng kiá»ƒm tra láº¡i máº¡ng.")
        sys.exit()

# Gá»i kiá»ƒm tra máº¡ng vÃ  hiá»‡n banner
os.system('cls' if os.name == 'nt' else 'clear')
kiem_tra_mang()
print(banner)
time.sleep(1.2)

# Äá»c hoáº·c nháº­p Authorization + Token
try:
    open("Authorization.txt", "x")
    open("token.txt", "x")
except:
    pass

with open("Authorization.txt", "r") as f: author = f.read().strip()
with open("token.txt", "r") as f: token = f.read().strip()

if not author or not token:
    author = input(Colorate.Diagonal(Colors.red_to_green, " ğŸ’¸ NHáº¬P AUTHORIZATION GOLIKE : \033[1;33m"))
    token = input(Colorate.Diagonal(Colors.green_to_red, "ğŸ’¸  NHáº¬P TOKEN (T Cá»¦A GOLIKE): \033[1;33m"))
    with open("Authorization.txt", "w") as f: f.write(author)
    with open("token.txt", "w") as f: f.write(token)
else:
    print(Colorate.Diagonal(Colors.white_to_black, "=================================================="))
    print(Colorate.Diagonal(Colors.red_to_white, "Nháº­p [1] Äá»ƒ VÃ o Tool Golike Threads "))
    print(Colorate.Diagonal(Colors.red_to_white, "Nháº­p [2] Äá»ƒ Thay Auth Golike Má»›i "))
    print(Colorate.Diagonal(Colors.white_to_black, "=================================================="))
    chon = input(f"\033[1;32mNháº­p sá»‘ : ")
    if chon == "2":
        for i in range(1, 101):
            sys.stdout.write(f"\r{BOLD}{AQUA} ÄANG TIáº¾N HÃ€NH XÃ“A AUTH CÅ¨ : [{i}% {'â•‘' * (i // 2)}]{RESET}")
            sys.stdout.flush()
            time.sleep(0.02)
        os.system('cls' if os.name == 'nt' else 'clear')
        print(banner)
        author = input("\033[1;33mNháº­p Auth Golike Má»›i : ")
        token = input("\033[1;32mNháº­p T Golike Má»›i : \033[1;33m")
        with open("Authorization.txt", "w") as f: f.write(author)
        with open("token.txt", "w") as f: f.write(token)

# Header chung
headers = {
    'Accept': 'application/json, text/plain, */*',
    'Content-Type': 'application/json;charset=utf-8',
    'Authorization': author,
    't': token,
    'User-Agent': 'Mozilla/5.0',
    'Referer': 'https://app.golike.net/account/manager/threads',
}

def chonacc():
    try:
        res = scraper.get('https://gateway.golike.net/api/threads-account', headers=headers).json()
        return res
    except: return None

def nhannv(account_id):
    try:
        res = scraper.get(
            'https://gateway.golike.net/api/advertising/publishers/threads/jobs',
            headers=headers,
            params={'account_id': account_id}
        ).json()
        return res
    except: return None

def hoanthanh(ads_id, account_id):
    try:
        res = scraper.post(
            'https://gateway.golike.net/api/advertising/publishers/threads/complete-jobs',
            headers=headers,
            json={
                'ads_id': ads_id,
                'account_id': account_id,
                'async': True,
                'data': None
            }
        ).json()
        return res
    except: return None

def baoloi(ads_id, object_id, account_id, job_type):
    try:
        scraper.post('https://gateway.golike.net/api/report/send', headers=headers, json={
            'description': 'TÃ´i Ä‘Ã£ lÃ m Job nÃ y rá»“i',
            'users_advertising_id': ads_id,
            'type': 'ads',
            'provider': 'tiktok',
            'fb_id': account_id,
            'error_type': 6,
        })

        scraper.post('https://gateway.golike.net/api/advertising/publishers/threads/skip-jobs', headers=headers, json={
            'ads_id': ads_id,
            'object_id': object_id,
            'account_id': account_id,
            'type': job_type
        })
    except: pass

# Báº¯t Ä‘áº§u chá»n acc
data_acc = chonacc()
if not data_acc or data_acc.get("status") != 200:
    print("\033[1;31mAuthorization hoáº·c Token sai!")
    sys.exit()

for idx, acc in enumerate(data_acc["data"], 1):
    print(Colorate.Diagonal(Colors.green_to_red, f"[{idx}] {acc['name']} | Online"))

chon = int(input("\nChá»n STT tÃ i khoáº£n Ä‘á»ƒ cháº¡y: ")) - 1
acc_selected = data_acc["data"][chon]
account_id = acc_selected["id"]
name = acc_selected["name"]

# Chá»n cáº¥u hÃ¬nh
os.system('cls' if os.name == 'nt' else 'clear')
print(banner)
delay = int(input("â³ Delay má»—i job (giÃ¢y): "))
max_job = int(input("ğŸ” Sá»‘ job tá»‘i Ä‘a má»—i tÃ i khoáº£n: "))
fail_limit = int(input("âŒ Sá»‘ láº§n lá»—i Ä‘á»ƒ chuyá»ƒn acc: "))
proxy_input = input("ğŸŒ Proxy (Enter Ä‘á»ƒ bá» qua): ").strip()
proxies = {
    "http": f"http://{proxy_input}",
    "https": f"http://{proxy_input}"
} if proxy_input else None

# Chá»n nhiá»‡m vá»¥
print("\n[1] Follow")
while True:
    try:
        loai_nv = int(input("Chá»n nhiá»‡m vá»¥ (1): "))
        if loai_nv == 1:
            break
        print("Chá»‰ cÃ³ nhiá»‡m vá»¥ sá»‘ 1 hiá»‡n táº¡i.")
    except:
        print("Vui lÃ²ng nháº­p sá»‘!")

# Cháº¡y job
ads_done = set()
done, tong, fail = 0, 0, 0

while done < max_job:
    job = nhannv(account_id)
    if not job or job.get("status") != 200 or not job["data"].get("link"):
        print("KhÃ´ng nháº­n Ä‘Æ°á»£c job phÃ¹ há»£p...")
        fail += 1
        time.sleep(2)
        if fail >= fail_limit:
            print("Lá»—i nhiá»u â†’ chuyá»ƒn acc")
            break
        continue

    ads_id = job["data"]["id"]
    object_id = job["data"]["object_id"]
    job_type = job["data"]["type"]

    if ads_id in ads_done or job_type != "follow":
        baoloi(ads_id, object_id, account_id, job_type)
        continue

    # Äáº¿m ngÆ°á»£c delay
    for sec in range(delay, -1, -1):
        color = "\033[1;36m" if sec % 2 else "\033[1;35m"
        print(f"\r{color}Äang chá» {sec}s...", end="")
        time.sleep(1)

    nhantien = hoanthanh(ads_id, account_id)
    if nhantien and nhantien.get("status") == 200:
        tien = nhantien["data"]["prices"]
        tong += tien
        done += 1
        ads_done.add(ads_id)

        table = Table(show_header=True, header_style="bold cyan")
        table.add_column("STT", justify="center")
        table.add_column("Thá»i gian")
        table.add_column("TÃ i khoáº£n")
        table.add_column("Tráº¡ng thÃ¡i")
        table.add_column("Tiá»n", justify="right")
        table.add_column("Tá»•ng", justify="right")
        table.add_row(str(done), time.strftime("%H:%M:%S"), name, "âœ…", f"{tien}Ä‘", f"{tong}Ä‘")

        os.system('cls' if os.name == 'nt' else 'clear')
        print(banner)
        console.print(table)
        time.sleep(1.5)
    else:
        baoloi(ads_id, object_id, account_id, job_type)
        fail += 1
        if fail >= fail_limit:
            print("Lá»—i nhiá»u quÃ¡ â†’ chuyá»ƒn acc")
            break
